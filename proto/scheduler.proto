syntax = "proto3";

package scheduler;

option go_package = "github.com/bhanuprakaash/job-scheduler/proto";

import "google/api/annotations.proto";
// JobScheduler is the core service for managing background tasks.
//
// It allows clients to submit asynchronous jobs (like emails, billing, resizing)
// and poll for their status. This service is designed to be horizontally scalable
// and backed by a persistent store.
service JobScheduler {
  // SubmitJob enqueues a new job for execution.
  // It returns the generated Job ID and Status immediately while the job runs in the background.
  rpc SubmitJob(SubmitJobRequest) returns (SubmitJobResponse) {
    option (google.api.http) = {
      post: "/v1/jobs"
      body: "*"
    };
  }

  // GetJob retrieves the current status and details of a specific job.
  // Use this to poll for completion or to retrieve the output of a finished job.
  // Errors:
  //  - NOT_FOUND: Returned if the provided job_id does not exist in the store.
  //  - INVALID_ARGUMENT: Returned if the job_id is malformed.
  rpc GetJob(GetJobRequest) returns (GetJobResponse) {
    option (google.api.http) = {
      get: "/v1/jobs/{job_id}"
    };
  }

  // For the Jobs Table (Pagination)
  rpc ListJobs(ListJobRequest) returns (ListJobResponse) {
    option (google.api.http) = {
      get: "/v1/jobs"
    };
  }

  // Dashboard Stats (Pulse)
  rpc GetJobStats(GetJobStatsRequest) returns (GetJobStatusResponse) {
    option (google.api.http) = {
      get: "/v1/stats"
    };
  }
}

message SubmitJobRequest {
  string type    = 1;
  string payload = 2;
}

message SubmitJobResponse {
  string job_id = 1;
  string status = 2;
}

message GetJobRequest {
  string job_id = 1;
}

message GetJobResponse {
  string job_id        = 1;
  string type          = 2;
  string payload       = 3;
  string status        = 4;
  string created_at    = 5;
  string completed_at  = 6;
  string error_message = 7;
  string retry_count   = 8;
}

message ListJobRequest {
  int32 limit  = 1;
  int32 offset = 2;
}

message PaginationMetaData {
  int32 current_page  = 1;
  int32 total_pages   = 2;
  int64 total_records = 3;
  int32 limit         = 4;
}

message ListJobResponse {
  repeated GetJobResponse jobs = 1;
  PaginationMetaData      meta = 2;
}

message GetJobStatsRequest {}

message GetJobStatusResponse {
  int64 total_jobs     = 1;
  int64 pending_jobs   = 2;
  int64 running_jobs   = 3;
  int64 failed_jobs    = 4;
  int64 completed_jobs = 5;
}